name: Maven Build and Deploy

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          distribution: "adopt"
          java-version: "11"

      - name: Install DEB Package
        run: |
          sudo apt-get update
          sudo apt-get install -y openjdk-11-jre
          sudo apt-get install -y default-jre

      - name: Import JAR file to Local Maven Repository
        run: mvn install:install-file -Dfile=/usr/share/tvbrowser/tvbrowser.jar -DgroupId=tvbrowser -DartifactId=core -Dversion=4.2.7 -Dpackaging=jar

      - name: Build with Maven
        run: mvn -B package --file pom.xml

      - name: Get GitVersion
        id: git_version
        run: gitversion /output json > version.json

      - name: Create Release
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ fromJson(steps.git_version.outputs.stdout).MajorMinorPatch }}
          release_name: Release ${{ fromJson(steps.git_version.outputs.stdout).MajorMinorPatch }}
          draft: false
          prerelease: false

      - name: Upload Artifact
        if: steps.create_release.outputs.upload_url
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: /home/runner/work/TvHBrowser/TvHBrowser/target/TvHBrowser.jar  # Hier den Pfad zu deinem Artefakt angeben
          asset_name: TvHBrowser.jar  # Hier den Namen deines Artefakts angeben
          asset_content_type: application/java-archive

      - name: Clean Up
        run: rm deb-package.deb

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./target # Hier wird das target-Verzeichnis als Verzeichnis f√ºr das Deployment angegeben
